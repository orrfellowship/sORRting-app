!function(e){var n={};function r(a){if(n[a])return n[a].exports;var t=n[a]={i:a,l:!1,exports:{}};return e[a].call(t.exports,t,t.exports,r),t.l=!0,t.exports}r.m=e,r.c=n,r.d=function(e,n,a){r.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,n){if(1&n&&(e=r(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var t in e)r.d(a,t,function(n){return e[n]}.bind(null,t));return a},r.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(n,"a",n),n},r.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},r.p="./dist/",r(r.s=0)}([function(e,n,r){self.importScripts("https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js");var a=r(1);function t(e){return _.each(e,(function(e){e.percentageOfMax=0,e.companyScore=0,e.adjScore=0,e.topPreferences=[]})),e}function c(e){return _.each(e,(function(e){e.count=0,e.repeats="",e.name=i(e.name);for(var n=0;n<e.schedule.length;n++)e.schedule[n]=null})),e}function o(e,n){for(var r=0,a=0,t=0;t<e.preferences.length&&(_.findWhere(n,{name:e.preferences[t]})&&(r+=20-t,a++),8!=a);t++);return r}function s(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return-1!==u(e.name,"?")?e.decGrad=!0:e.decGrad=!1,n&&(e.name=i(e.name)),e}function i(e){var n=u(e,"?");return-1!==n?e.slice(0,n):e}function u(e,n){for(var r=0;r<e.length;r++)if(e[r]===n)return r;return-1}function f(e){for(var n=0;n<e.length;n++)if(e[n].decGrad){var r=e[n].name;e[n].name=r.concat("?decGrad")}return e}function d(e,n,r){for(var a=[],t=0;t<e.length;t++)_.contains(n,e[t])?a.push(e[t].concat(r)):a.push(e[t]);return a}function l(e){for(var n=[],r=0;r<e.length;r++)e[r].decGrad&&n.push(e[r].name);return n}self.onmessage=function(e){switch(e.data.aTopic){case"load":var n=new TextDecoder;!function(e){var n=e.iterations,r=e.companies,i=e.candidates,u=e.slots,p=e.candidate_slots,h=e.maxConsecutive;r=function(e){for(var n=[],r=0;r<e.length;r+=2){var a={};a.name=e[r].name,a.preferences=e[r].preferences;for(var t=[],c=e[r+1].preferences,o=0;o<c.length;o++)""!==c[o]&&t.push(c[o]);a.exceptions=t,n.push(a)}return n}(r);var m=0;r=function(e,n){return _.each(e,(function(e){e.maxScore=o(e,n),e.percentageOfMax=0,e.companyScore=0,e.adjScore=0,e.topPreferences=[],e=s(e,!1)})),e}(r,i),i=function(e,n){return _.each(e,(function(e){e.repeats="",e.schedule=new Array(n),e=s(e)})),e}(i,u);for(var v=0;v<n;v++){i=c(i),r=t(r);var g=new a(i,r,u,p,h),x=g.score(),S=l(i);i=f(i);var y=_.map(g.schedule,(function(e,n){return{company:r[n].name,preferences:r[n].topPreferences,interviews:d(e,S,"?decGrad"),maxScore:r[n].maxScore,score:r[n].companyScore,percentageOfMax:r[n].percentageOfMax,adjScore:r[n].adjScore}}));if(self.postMessage(v+1),x.score>m){v=0,m=x.score;var b=new TextEncoder("utf-8"),j={score:x.score,adjScore:x.adjScore,avgPercent:x.avgPercent,data:y,candidates:i,companies:r,schedule:g.schedule,maxConsecutive:h},O=b.encode(JSON.stringify(j)).buffer;self.postMessage({aTopic:"newMax",aBuf:O},[O]),g}}close()}(JSON.parse(n.decode(e.data.aBuf)));break;case"populate":n=new TextDecoder;!function(e){e.iterations;var n=e.companies,r=e.candidates,t=e.slots,c=e.candidate_slots,s=e.schedule,u=e.newCompanies,p=e.newCandidates,h=e.maxConsecutive;r=p,n=u,_.each(r,(function(e){e.name=i(e.name)}));var m=new a(r,n,t,c,h,s);m.populateCandidates();var v=l(r);_.each(n,(function(e){e.maxScore=o(e,r)}));var g=m.score();m.candidates=f(m.candidates);var x=_.map(m.schedule,(function(e,r){return{company:n[r].name,preferences:n[r].topPreferences,interviews:d(e,v,"?decGrad"),maxScore:n[r].maxScore,score:n[r].companyScore,percentageOfMax:n[r].percentageOfMax,adjScore:n[r].adjScore}})),S=new TextEncoder("utf-8").encode(JSON.stringify({score:g.score,adjScore:g.adjScore,avgPercent:g.avgPercent,candidates:m.candidates,companies:m.companies,schedule:m.schedule,data:x})).buffer;self.postMessage({aTopic:"populated",aBuf:S},[S]),close()}(JSON.parse(n.decode(e.data.aBuf)));break;default:throw"no aTopic on incoming message to ChromeWorker"}}},function(e,n){function r(e,n,r,t,c,o){if(this.candidates=e,this.companies=n,this.slots=r,this.candidate_slots=t,this.maxConsecutive=c,o)this.schedule=o;else{o=new Array(n.length);for(var s=0;s<n.length;s++)o[s]=new Array(r);for(var i=_.shuffle(_.range(n.length)),u=_.shuffle(_.range(r)),f=!1,d=!1;!f;){f=!0,i=_.shuffle(i);for(var l=0;l<n.length;l++){var p=i[l],h=n[p],m=h.preferences;u=_.shuffle(u);for(var v=0;v<r;v++){var g=u[v];if(_.isEmpty(o[p][g])){for(var x=0;x<m.length;x++){var S=_.findWhere(e,{name:m[x]});if(S)if(S.count<t)if(S.decGrad&&h.decGrad){if(a(o,p,g,S,h,this.maxConsecutive,x)){f=!1,d=!0;break}}else if(S.decGrad&&!h.decGrad){if(!_.contains(h.exceptions,S.name))continue;if(a(o,p,g,S,h,this.maxConsecutive,x)){f=!1,d=!0;break}}else{if(a(o,p,g,S,h,this.maxConsecutive,x)){f=!1,d=!0;break}}}if(d){d=!1;break}}}}}this.schedule=o}}function a(e,n,r,a,o,s,i){return!!t(e,n,r,a,o.name,s)&&(e[n][r]=a.name,a.count++,a.schedule[r]=o.name,c(a),i<2&&o.topPreferences.push(i+1),!0)}function t(e,n,r,a,t,c){if(_.contains(e[n],a.name))return!1;if(_.contains(a.schedule,t))return!1;if(null!==a.schedule[r])return!1;var o,s,i=(o=a.schedule,s=[],_.each(o,(function(e){s.push(e)})),s);i[r]=a.name;for(var u=0,f=0,d=0;d<i.length;d++)null!==i[d]?++f>u&&(u=f):f=0;return!(u>c)}function c(e){for(var n=0,r=0,a=0;a<e.schedule.length;a++)null!==e.schedule[a]?++r>n&&(n=r):r=0;n>2&&(e.repeats="".concat(n," consecutive"))}function o(e){var n=[];return _.each(e,(function(e,r){var a={};a.count=e.count,a.decGrad=e.decGrad,a.name=e.name,a.repeats=e.repeats,a.schedule=[];for(var t=0;t<e.schedule.length;t++)a.schedule.push(e.schedule[t]);n.push(a)})),n}r.prototype={},r.prototype.constructor=r,r.prototype.score=function(){for(var e=0,n=0,r=0,a=0;a<this.companies.length;a++){for(var t=0,c=this.companies[a],o=c.preferences,s=0;s<this.slots;s++){var i=this.schedule[a][s];_.contains(o,i)&&(t+=20-_.indexOf(o,i))}c.companyScore=t,c.percentageOfMax=Number((t/c.maxScore).toFixed(4)),c.adjScore=Number((t*c.percentageOfMax).toFixed(2)),e+=t,r+=c.adjScore,n+=c.percentageOfMax}var u=Number((n/this.companies.length).toFixed(4));return{score:e,adjScore:Number(r.toFixed(0)),avgPercent:u}},r.prototype.populateCandidates=function(){for(var e=this,n=o(e.candidates),r=!1,a=0;!r&&a<1e4;){++a,e.candidates=o(n);var s=_.shuffle(_.range(e.companies.length)),i=[];_.each(e.candidates,(function(n){for(var r=n.count;r<e.candidate_slots;r++)i.push(n.name)}));var u=JSON.parse(JSON.stringify(e.schedule));r=!0;for(var f=0;f<e.companies.length;f++)for(var d=s[f],l=e.companies[d],p=0;p<e.slots;p++)if(_.isEmpty(u[d][p])){for(var h=i.length,m=0;m<h;m++){var v=_.findWhere(e.candidates,{name:i[m]});if(v.decGrad&&l.decGrad){if(t(u,d,p,v,l.name,e.maxConsecutive)){u[d][p]=v.name,v.schedule[p]=l.name,v.count++,c(v),i.splice(m,1);break}}else if(v.decGrad&&!l.decGrad){if(!_.contains(l.exceptions,v.name))continue;if(t(u,d,p,v,l.name,e.maxConsecutive)){u[d][p]=v.name,v.schedule[p]=l.name,v.count++,c(v),i.splice(m,1);break}}else if(t(u,d,p,v,l.name,e.maxConsecutive)){u[d][p]=v.name,v.schedule[p]=l.name,v.count++,c(v),i.splice(m,1);break}}m===h&&(r=!1)}r&&(e.validateInterviewCounts()||(r=!1))}e.schedule=u},r.prototype.validateInterviewCounts=function(){return!0},e.exports=r}]);
//# sourceMappingURL=f1ef333dc0229067a66e.worker.js.map